<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RPG Batalha por Turnos</title>
<style>
    body { background: #1a1a1a; color: #fff; font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    button { background: #444; color: #fff; border: none; padding: 10px 20px; margin: 5px; font-size: 1.2em; cursor: pointer; border-radius: 5px; }
    button:hover { background: #666; }
    button:disabled { background: #222; color: #666; cursor: not-allowed; }
    #battleLog { width: 90%; height: 200px; background: #000; color: lime; overflow-y: auto; margin: 10px auto; padding: 10px; text-align: left; border: 1px solid #555; border-radius: 5px; }
    .bar-container { width: 80%; background: #333; margin: 5px auto; height: 20px; border-radius: 5px; overflow: hidden; }
    .hp-bar { height: 100%; background: #4caf50; width: 100%; transition: width 0.3s; }
    .xp-bar { height: 100%; background: #2196f3; width: 0%; transition: width 0.3s; }
    .ficha-personagem { background: #2a2a2a; border-radius: 10px; padding: 15px; margin: 20px auto; max-width: 400px; border: 2px solid #444; }
    .ficha-linha { display: flex; justify-content: space-between; margin: 8px 0; padding: 5px; background: #333; border-radius: 5px; }
    .ficha-label { font-weight: bold; color: #ffd700; }
    .combatentes { display: flex; justify-content: space-around; margin: 20px 0; }
    .combatente { background: #2a2a2a; border-radius: 10px; padding: 15px; margin: 10px; border: 2px solid #444; flex: 1; max-width: 300px; }
    .combatente h3 { color: #ffd700; margin-bottom: 10px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: white; z-index: 9999; text-align: center; padding-top: 10%; }
    .modal-content { background: #2a2a2a; padding: 30px; border-radius: 10px; margin: 0 auto; max-width: 500px; border: 2px solid #444; max-height: 80%; overflow-y: auto; }
    .modal button { background: #ff9800; font-size: 1.2em; }
    .ouro { color: #ffd700; font-weight: bold; }
    .aviso { color: #ff6b6b; font-style: italic; }
    .status { display: flex; flex-wrap: wrap; gap: 5px; margin: 5px 0; }
    .status-item { background: #ff4444; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }
    .status-item.buff { background: #44ff44; }
    .loja { background: #2a2a2a; border-radius: 10px; padding: 15px; margin: 20px auto; max-width: 400px; border: 2px solid #444; }
    .item-loja { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; padding: 8px; background: #333; border-radius: 5px; }
    .inventario { display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
    .item-inventario { background: #333; padding: 5px 10px; border-radius: 5px; font-size: 0.9em; }
    .lista-consumiveis { max-height: 200px; overflow-y: auto; }
    @media (max-width: 600px) { .combatentes { flex-direction: column; } .modal-content { max-width: 90%; } }
</style>
</head>
<body>

<div id="cidade">
    <h1>üè∞ Cidade</h1>
    <div class="ficha-personagem">
        <h2>‚öîÔ∏è Ficha do Personagem</h2>
        <div class="ficha-linha"><span class="ficha-label">Nome:</span><span id="nomeHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">N√≠vel:</span><span id="nivelHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Ouro:</span><span class="ouro" id="ouroHeroi"></span>üí∞</div>
        <div class="ficha-linha"><span class="ficha-label">HP:</span><span><span id="hpHeroi"></span>/<span id="hpMaxHeroi"></span></span></div>
        <div class="bar-container"><div id="hpBar" class="hp-bar"></div></div>
        <div class="ficha-linha"><span class="ficha-label">XP:</span><span><span id="xpHeroi"></span>/<span id="xpProxNivel"></span></span></div>
        <div class="bar-container"><div id="xpBar" class="xp-bar"></div></div>
        <div class="ficha-linha"><span class="ficha-label">For√ßa:</span><span id="forcaHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Defesa:</span><span id="defesaHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Agilidade:</span><span id="agiHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Vit√≥rias:</span><span id="vitoriasHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Derrotas:</span><span id="derrotasHeroi"></span></div>
        
        <h3>üì¶ Invent√°rio</h3>
        <div class="inventario" id="inventarioDisplay"></div>
    </div>
    
    <div class="loja">
        <h2>üõí Loja de Consum√≠veis</h2>
        <div id="listaLoja"></div>
    </div>
    
    <div style="margin: 20px;">
        <p>üíö <strong>Recuperar HP:</strong> Custa <span class="ouro">20 ouro</span></p>
        <p id="avisoOuro" class="aviso" style="display: none;">Ouro insuficiente para recuperar!</p>
    </div>
    
    <button id="btnRecuperar" onclick="recuperar()">üíö Recuperar (20üí∞)</button>
    <button onclick="iniciarBatalha()">‚öîÔ∏è Lutar</button>
</div>

<div id="batalha" style="display:none;">
    <h1>‚öîÔ∏è Batalha</h1>
    <div class="combatentes">
        <div class="combatente">
            <h3>üë§ <span id="nomeHeroiBatalha"></span></h3>
            <p>N√≠vel: <span id="nivelHeroiBatalha"></span> | Ouro: <span class="ouro" id="ouroHeroiBatalha"></span>üí∞</p>
            <p>HP: <span id="hpHeroiBatalha"></span>/<span id="hpMaxHeroiBatalha"></span></p>
            <div class="bar-container"><div id="hpBarHeroiBatalha" class="hp-bar"></div></div>
            <p>Agi: <span id="agiHeroiBatalha"></span></p>
            <div class="status" id="statusHeroiBatalha"></div>
        </div>
        <div class="combatente">
            <h3>üëπ <span id="nomeInimigo"></span></h3>
            <p>Tesouro: <span class="ouro" id="tesouroInimigo"></span>üí∞</p>
            <p>HP: <span id="hpInimigo"></span>/<span id="hpMaxInimigo"></span></p>
            <div class="bar-container"><div id="hpBarInimigo" class="hp-bar" style="background:#f44336;"></div></div>
            <p>Agi: <span id="agiInimigo"></span></p>
            <div class="status" id="statusInimigo"></div>
        </div>
    </div>
    <div id="battleLog"></div>
    <button onclick="atacar()">‚öîÔ∏è Atacar</button>
    <button id="btnUsarItem" onclick="mostrarConsumivel()">üß™ Usar Item</button>
    <button onclick="fugir()">üèÉ Fugir</button>
</div>

<!-- Modal Level Up -->
<div id="telaLevelUp" class="modal">
    <div class="modal-content">
        <h2>üéâ Level Up!</h2>
        <p>Voc√™ subiu para o n√≠vel <span id="novoNivel"></span>!</p>
        <p>Seus atributos melhoraram!</p>
        <button onclick="fecharLevelUp()">OK</button>
    </div>
</div>

<!-- Modal Game Over -->
<div id="telaGameOver" class="modal">
    <div class="modal-content">
        <h2>üíÄ Game Over</h2>
        <p>Seu her√≥i foi derrotado e n√£o conseguiu se recuperar...</p>
        <hr>
        <h3>üìä Estat√≠sticas Finais:</h3>
        <div class="ficha-linha"><span class="ficha-label">N√≠vel Alcan√ßado:</span><span id="estatNivel"></span></div>
        <div class="ficha-linha"><span class="ficha-label">XP Total Acumulado:</span><span id="estatXpTotal"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Ouro Final:</span><span class="ouro" id="estatOuroFinal"></span>üí∞</div>
        <div class="ficha-linha"><span class="ficha-label">Vit√≥rias:</span><span id="estatVitorias"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Derrotas:</span><span id="estatDerrotas"></span></div>
        <hr>
        <button onclick="reiniciarJogo()">üîÑ Novo Jogo</button>
    </div>
</div>

<!-- Modal Consum√≠veis -->
<div id="modalConsumiveis" class="modal">
    <div class="modal-content">
        <h2>üß™ Usar Consum√≠vel</h2>
        <div class="lista-consumiveis" id="listaConsumiveis"></div>
        <button onclick="fecharConsumiveis()">Cancelar</button>
    </div>
</div>

<script>
let heroi = {
    nome: "Her√≥i",
    nivel: 1,
    hpMax: 50,
    hp: 50,
    xp: 0,
    xpProx: 100,
    ouro: 100, // come√ßar com mais ouro para poder comprar itens
    forca: 10,
    defesa: 5,
    agilidade: 5,
    dano: 15,
    vitorias: 0,
    derrotas: 0,
    xpTotal: 0,
    status: {
        veneno: 0,
        paralisia: 0,
        forcaBuff: 0,
        defesaBuff: 0
    },
    inventario: {
        pocao: 2, // come√ßar com algumas po√ß√µes
        antidoto: 1,
        pocaoForca: 0,
        pocaoDefesa: 0
    }
};

// Lista de consum√≠veis dispon√≠veis na loja
const consumiveisLoja = [
    {nome: "Po√ß√£o de Cura", id: "pocao", preco: 30, descricao: "Restaura 30 HP"},
    {nome: "Ant√≠doto", id: "antidoto", preco: 20, descricao: "Remove veneno e paralisia"},
    {nome: "Po√ß√£o de For√ßa", id: "pocaoForca", preco: 50, descricao: "Aumenta ataque por 5 turnos"},
    {nome: "Po√ß√£o de Defesa", id: "pocaoDefesa", preco: 40, descricao: "Aumenta defesa por 5 turnos"}
];

// Lista de 25 monstros (alguns com habilidades especiais de status)
const listaMonstros = [
    // Fracos (mais comuns)
    {nome: "Slime", hpMax: 20, forca: 5, defesa: 2, agilidade: 3, peso: 40, tesouro: 10},
    {nome: "Rato Gigante", hpMax: 18, forca: 4, defesa: 1, agilidade: 5, peso: 38, tesouro: 8},
    {nome: "Morcego Sombrio", hpMax: 16, forca: 5, defesa: 1, agilidade: 7, peso: 35, tesouro: 9},
    {nome: "Abelha Assassina", hpMax: 14, forca: 6, defesa: 1, agilidade: 9, peso: 34, tesouro: 10, status: "veneno"},
    {nome: "Goblin", hpMax: 22, forca: 6, defesa: 2, agilidade: 4, peso: 32, tesouro: 12},

    // Pouco fortes
    {nome: "Lobo", hpMax: 30, forca: 8, defesa: 4, agilidade: 6, peso: 25, tesouro: 15},
    {nome: "Gnoll", hpMax: 28, forca: 9, defesa: 3, agilidade: 5, peso: 24, tesouro: 16},
    {nome: "Kobold", hpMax: 26, forca: 8, defesa: 3, agilidade: 7, peso: 23, tesouro: 14},
    {nome: "Zumbi", hpMax: 35, forca: 7, defesa: 5, agilidade: 2, peso: 22, tesouro: 18, status: "paralisia"},
    {nome: "Esqueleto Soldado", hpMax: 32, forca: 8, defesa: 4, agilidade: 3, peso: 21, tesouro: 17},

    // M√©dios
    {nome: "Orc", hpMax: 45, forca: 12, defesa: 6, agilidade: 4, peso: 20, tesouro: 25},
    {nome: "Lan√ßador de Rocha", hpMax: 50, forca: 11, defesa: 7, agilidade: 3, peso: 18, tesouro: 28},
    {nome: "Arqueiro Bandido", hpMax: 40, forca: 9, defesa: 5, agilidade: 8, peso: 18, tesouro: 26},
    {nome: "Aranha Gigante", hpMax: 38, forca: 10, defesa: 4, agilidade: 7, peso: 17, tesouro: 22, status: "veneno"},
    {nome: "Troglodita", hpMax: 48, forca: 11, defesa: 6, agilidade: 5, peso: 16, tesouro: 24},

    // Fortes
    {nome: "Cavaleiro Negro", hpMax: 60, forca: 15, defesa: 10, agilidade: 7, peso: 10, tesouro: 40},
    {nome: "Minotauro", hpMax: 65, forca: 17, defesa: 9, agilidade: 6, peso: 9, tesouro: 45},
    {nome: "Homem Urso", hpMax: 62, forca: 16, defesa: 8, agilidade: 5, peso: 8, tesouro: 42},
    {nome: "G√°rgula Viva", hpMax: 55, forca: 14, defesa: 12, agilidade: 4, peso: 8, tesouro: 38, status: "paralisia"},
    {nome: "Elemental de Terra", hpMax: 70, forca: 18, defesa: 14, agilidade: 3, peso: 7, tesouro: 50},

    // Muito fortes (raros)
    {nome: "Drag√£o Jovem", hpMax: 80, forca: 20, defesa: 12, agilidade: 8, peso: 5, tesouro: 80},
    {nome: "Quimera", hpMax: 85, forca: 21, defesa: 13, agilidade: 7, peso: 4, tesouro: 85, status: "veneno"},
    {nome: "Hidra Menor", hpMax: 90, forca: 22, defesa: 14, agilidade: 6, peso: 3, tesouro: 90},
    {nome: "Drag√£o Anci√£o", hpMax: 100, forca: 25, defesa: 15, agilidade: 9, peso: 2, tesouro: 120},
    {nome: "Dem√¥nio de Fogo", hpMax: 95, forca: 23, defesa: 13, agilidade: 8, peso: 2, tesouro: 100, status: "paralisia"}
];

let inimigo = {};
const custoRecuperacao = 20;

function atualizarCidade(){
    document.getElementById("nomeHeroi").innerText = heroi.nome;
    document.getElementById("nivelHeroi").innerText = heroi.nivel;
    document.getElementById("ouroHeroi").innerText = heroi.ouro;
    document.getElementById("hpHeroi").innerText = heroi.hp;
    document.getElementById("hpMaxHeroi").innerText = heroi.hpMax;
    document.getElementById("hpBar").style.width = (heroi.hp/heroi.hpMax)*100 + "%";
    document.getElementById("xpHeroi").innerText = heroi.xp;
    document.getElementById("xpProxNivel").innerText = heroi.xpProx;
    document.getElementById("xpBar").style.width = (heroi.xp/heroi.xpProx)*100 + "%";
    document.getElementById("forcaHeroi").innerText = heroi.forca;
    document.getElementById("defesaHeroi").innerText = heroi.defesa;
    document.getElementById("agiHeroi").innerText = heroi.agilidade;
    document.getElementById("vitoriasHeroi").innerText = heroi.vitorias;
    document.getElementById("derrotasHeroi").innerText = heroi.derrotas;
    
    atualizarInventarioDisplay();
    atualizarLoja();
    
    // Verificar se pode recuperar
    if (heroi.ouro >= custoRecuperacao && heroi.hp < heroi.hpMax) {
        document.getElementById("btnRecuperar").disabled = false;
        document.getElementById("avisoOuro").style.display = "none";
    } else {
        document.getElementById("btnRecuperar").disabled = true;
        if (heroi.ouro < custoRecuperacao) {
            document.getElementById("avisoOuro").style.display = "block";
        } else {
            document.getElementById("avisoOuro").style.display = "none";
        }
    }
}

function atualizarInventarioDisplay(){
    const inventarioDiv = document.getElementById("inventarioDisplay");
    inventarioDiv.innerHTML = "";
    
    for (let [item, quantidade] of Object.entries(heroi.inventario)) {
        if (quantidade > 0) {
            const itemDiv = document.createElement("div");
            itemDiv.className = "item-inventario";
            const nomeItem = consumiveisLoja.find(c => c.id === item)?.nome || item;
            itemDiv.innerText = `${nomeItem}: ${quantidade}`;
            inventarioDiv.appendChild(itemDiv);
        }
    }
    
    if (inventarioDiv.innerHTML === "") {
        inventarioDiv.innerHTML = "<div class='item-inventario'>Invent√°rio vazio</div>";
    }
}

function atualizarLoja(){
    const lojaDiv = document.getElementById("listaLoja");
    lojaDiv.innerHTML = "";
    
    consumiveisLoja.forEach(item => {
        const itemDiv = document.createElement("div");
        itemDiv.className = "item-loja";
        
        const podeComprar = heroi.ouro >= item.preco;
        
        itemDiv.innerHTML = `
            <div>
                <strong>${item.nome}</strong><br>
                <small>${item.descricao}</small>
            </div>
            <div>
                <span class="ouro">${item.preco}üí∞</span>
                <button onclick="comprarItem('${item.id}')" ${!podeComprar ? 'disabled' : ''}>
                    Comprar
                </button>
            </div>
        `;
        
        lojaDiv.appendChild(itemDiv);
    });
}

function comprarItem(itemId){
    const item = consumiveisLoja.find(c => c.id === itemId);
    if (!item || heroi.ouro < item.preco) return;
    
    heroi.ouro -= item.preco;
    heroi.inventario[itemId]++;
    
    atualizarCidade();
    alert(`${item.nome} comprado!`);
}

function atualizarBatalha(){
    document.getElementById("nomeHeroiBatalha").innerText = heroi.nome;
    document.getElementById("nivelHeroiBatalha").innerText = heroi.nivel;
    document.getElementById("ouroHeroiBatalha").innerText = heroi.ouro;
    document.getElementById("hpHeroiBatalha").innerText = heroi.hp;
    document.getElementById("hpMaxHeroiBatalha").innerText = heroi.hpMax;
    document.getElementById("hpBarHeroiBatalha").style.width = (heroi.hp/heroi.hpMax)*100 + "%";
    document.getElementById("agiHeroiBatalha").innerText = heroi.agilidade;
    
    document.getElementById("nomeInimigo").innerText = inimigo.nome;
    document.getElementById("tesouroInimigo").innerText = inimigo.tesouro;
    document.getElementById("hpInimigo").innerText = inimigo.hp;
    document.getElementById("hpMaxInimigo").innerText = inimigo.hpMax;
    document.getElementById("hpBarInimigo").style.width = (inimigo.hp/inimigo.hpMax)*100 + "%";
    document.getElementById("agiInimigo").innerText = inimigo.agilidade;
    
    atualizarStatusDisplay();
    atualizarBotaoItem();
}

function atualizarStatusDisplay(){
    // Status do her√≥i
    const statusHeroiDiv = document.getElementById("statusHeroiBatalha");
    statusHeroiDiv.innerHTML = "";
    
    if (heroi.status.veneno > 0) {
        statusHeroiDiv.innerHTML += `<div class="status-item">üü¢ Veneno ${heroi.status.veneno}</div>`;
    }
    if (heroi.status.paralisia > 0) {
        statusHeroiDiv.innerHTML += `<div class="status-item">‚ö° Paralisia ${heroi.status.paralisia}</div>`;
    }
    if (heroi.status.forcaBuff > 0) {
        statusHeroiDiv.innerHTML += `<div class="status-item buff">üí™ For√ßa+ ${heroi.status.forcaBuff}</div>`;
    }
    if (heroi.status.defesaBuff > 0) {
        statusHeroiDiv.innerHTML += `<div class="status-item buff">üõ°Ô∏è Defesa+ ${heroi.status.defesaBuff}</div>`;
    }
    
    // Status do inimigo
    const statusInimigoDiv = document.getElementById("statusInimigo");
    statusInimigoDiv.innerHTML = "";
    
    if (inimigo.status?.veneno > 0) {
        statusInimigoDiv.innerHTML += `<div class="status-item">üü¢ Veneno ${inimigo.status.veneno}</div>`;
    }
    if (inimigo.status?.paralisia > 0) {
        statusInimigoDiv.innerHTML += `<div class="status-item">‚ö° Paralisia ${inimigo.status.paralisia}</div>`;
    }
}

function atualizarBotaoItem(){
    const btnItem = document.getElementById("btnUsarItem");
    const temItens = Object.values(heroi.inventario).some(q => q > 0);
    btnItem.disabled = !temItens;
}

function selecionarInimigo(){
    let totalPeso = listaMonstros.reduce((sum, m) => sum + m.peso, 0);
    let r = Math.random() * totalPeso;
    for (let m of listaMonstros){
        if (r < m.peso) {
            const inimigo = JSON.parse(JSON.stringify(m));
            inimigo.status = { veneno: 0, paralisia: 0 };
            return inimigo;
        }
        r -= m.peso;
    }
}

function processarStatus(){
    // Processar status do her√≥i
    if (heroi.status.veneno > 0) {
        const dano = 3;
        heroi.hp -= dano;
        if (heroi.hp < 0) heroi.hp = 0;
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #44ff44;">Veneno causou ${dano} de dano no her√≥i!</span>`;
        heroi.status.veneno--;
    }
    
    if (heroi.status.forcaBuff > 0) heroi.status.forcaBuff--;
    if (heroi.status.defesaBuff > 0) heroi.status.defesaBuff--;
    if (heroi.status.paralisia > 0) heroi.status.paralisia--;
    
    // Processar status do inimigo
    if (inimigo.status?.veneno > 0) {
        const dano = 3;
        inimigo.hp -= dano;
        if (inimigo.hp < 0) inimigo.hp = 0;
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #44ff44;">Veneno causou ${dano} de dano no ${inimigo.nome}!</span>`;
        inimigo.status.veneno--;
    }
    
    if (inimigo.status?.paralisia > 0) inimigo.status.paralisia--;
}

function recuperar(){
    if (heroi.ouro >= custoRecuperacao && heroi.hp < heroi.hpMax) {
        heroi.ouro -= custoRecuperacao;
        heroi.hp = heroi.hpMax;
        atualizarCidade();
        alert("HP recuperado! (-20 ouro)");
    }
}

function iniciarBatalha(){
    inimigo = selecionarInimigo();
    inimigo.hp = inimigo.hpMax;
    
    document.getElementById("battleLog").innerHTML = `Um ${inimigo.nome} apareceu!<br>Voc√™ pode ganhar ${inimigo.tesouro} moedas de ouro!`;
    document.getElementById("cidade").style.display = "none";
    document.getElementById("batalha").style.display = "block";
    atualizarBatalha();
}

function chanceAcerto(agilAtacante, agilDefensor){
    let chance = 75 + (agilAtacante - agilDefensor) * 3;
    if(chance > 95) chance = 95;
    if(chance < 20) chance = 20;
    return chance;
}

function atacar(){
    // Verificar paralisia do her√≥i
    if (heroi.status.paralisia > 0 && Math.random() < 0.3) {
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #ff9800;">Voc√™ est√° paralisado e perdeu o turno!</span>`;
        setTimeout(turnoInimigo, 1000);
        return;
    }
    
    if(Math.random() * 100 < chanceAcerto(heroi.agilidade, inimigo.agilidade)){
        let dano = heroi.dano - Math.floor(inimigo.defesa/2);
        
        // Aplicar buff de for√ßa
        if (heroi.status.forcaBuff > 0) {
            dano += 5;
        }
        
        if (dano < 1) dano = 1;
        inimigo.hp -= dano;
        if(inimigo.hp < 0) inimigo.hp = 0;
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #4caf50;">Voc√™ acertou e causou ${dano} de dano!</span>`;
    } else {
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #ff9800;">Voc√™ errou o ataque!</span>`;
    }
    
    processarStatus();
    atualizarBatalha();
    
    if(inimigo.hp <= 0){ 
        vitoria(); 
        return; 
    }
    if(heroi.hp <= 0){ 
        derrota(); 
        return; 
    }
    
    setTimeout(turnoInimigo, 1000);
}

function turnoInimigo(){
    // Verificar paralisia do inimigo
    if (inimigo.status?.paralisia > 0 && Math.random() < 0.3) {
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #ff9800;">${inimigo.nome} est√° paralisado e perdeu o turno!</span>`;
        atualizarBatalha();
        return;
    }
    
    if(Math.random() * 100 < chanceAcerto(inimigo.agilidade, heroi.agilidade)){
        let dano = inimigo.forca - Math.floor((heroi.defesa + (heroi.status.defesaBuff > 0 ? 5 : 0))/2);
        if(dano < 1) dano = 1;
        heroi.hp -= dano;
        if(heroi.hp < 0) heroi.hp = 0;
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #f44336;">${inimigo.nome} acertou e causou ${dano} de dano!</span>`;
        
        // Aplicar status especial do monstro
        if (inimigo.status && Math.random() < 0.3) {
            if (inimigo.status === "veneno" && heroi.status.veneno === 0) {
                heroi.status.veneno = 3;
                document.getElementById("battleLog").innerHTML += `<br><span style="color: #44ff44;">Voc√™ foi envenenado!</span>`;
            } else if (inimigo.status === "paralisia" && heroi.status.paralisia === 0) {
                heroi.status.paralisia = 2;
                document.getElementById("battleLog").innerHTML += `<br><span style="color: #ffff44;">Voc√™ foi paralisado!</span>`;
            }
        }
    } else {
        document.getElementById("battleLog").innerHTML += `<br><span style="color: #ff9800;">${inimigo.nome} errou o ataque!</span>`;
    }
    
    atualizarBatalha();
    if(heroi.hp <= 0){ derrota(); }
}

function mostrarConsumivel(){
    const itensDisponiveis = Object.entries(heroi.inventario).filter(([item, qtd]) => qtd > 0);
    
    if (itensDisponiveis.length === 0) {
        alert("Nenhum item dispon√≠vel!");
        return;
    }
    
    const listaDiv = document.getElementById("listaConsumiveis");
    listaDiv.innerHTML = "";
    
    itensDisponiveis.forEach(([itemId, quantidade]) => {
        const item = consumiveisLoja.find(c => c.id === itemId);
        if (item) {
            const itemDiv = document.createElement("div");
            itemDiv.className = "item-loja";
            itemDiv.innerHTML = `
                <div>
                    <strong>${item.nome}</strong> (${quantidade})<br>
                    <small>${item.descricao}</small>
                </div>
                <button onclick="usarItem('${itemId}')">Usar</button>
            `;
            listaDiv.appendChild(itemDiv);
        }
    });
    
    document.getElementById("modalConsumiveis").style.display = "block";
}

function usarItem(itemId){
    if (heroi.inventario[itemId] <= 0) return;
    
    heroi.inventario[itemId]--;
    const item = consumiveisLoja.find(c => c.id === itemId);
    
    document.getElementById("battleLog").innerHTML += `<br><span style="color: #2196f3;">Voc√™ usou ${item.nome}!</span>`;
    
    switch(itemId) {
        case "pocao":
            const cura = 30;
            heroi.hp += cura;
            if (heroi.hp > heroi.hpMax) heroi.hp = heroi.hpMax;
            document.getElementById("battleLog").innerHTML += `<br><span style="color: #4caf50;">Voc√™ recuperou ${cura} HP!</span>`;
            break;
        case "antidoto":
            heroi.status.veneno = 0;
            heroi.status.paralisia = 0;
            document.getElementById("battleLog").innerHTML += `<br><span style="color: #4caf50;">Status negativos removidos!</span>`;
            break;
        case "pocaoForca":
            heroi.status.forcaBuff = 5;
            document.getElementById("battleLog").innerHTML += `<br><span style="color: #4caf50;">Sua for√ßa aumentou por 5 turnos!</span>`;
            break;
        case "pocaoDefesa":
            heroi.status.defesaBuff = 5;
            document.getElementById("battleLog").innerHTML += `<br><span style="color: #4caf50;">Sua defesa aumentou por 5 turnos!</span>`;
            break;
    }
    
    fecharConsumiveis();
    atualizarBatalha();
    
    // Turno do inimigo ap√≥s usar item
    setTimeout(turnoInimigo, 1000);
}

function fecharConsumiveis(){
    document.getElementById("modalConsumiveis").style.display = "none";
}

function fugir(){
    document.getElementById("battleLog").innerHTML += "<br><span style='color: #2196f3;'>Voc√™ fugiu da batalha!</span>";
    setTimeout(fimBatalha, 800);
}

function vitoria(){
    document.getElementById("battleLog").innerHTML += `<br><span style="color: #4caf50;">Voc√™ venceu!</span>`;
    document.getElementById("battleLog").innerHTML += `<br><span style="color: #ffd700;">Voc√™ ganhou ${inimigo.tesouro} moedas de ouro! üí∞</span>`;
    document.getElementById("battleLog").innerHTML += `<br><span style="color: #2196f3;">Voc√™ ganhou 50 XP!</span>`;
    
    heroi.vitorias++;
    heroi.ouro += inimigo.tesouro;
    heroi.xp += 50;
    heroi.xpTotal += 50;
    
    if(heroi.xp >= heroi.xpProx){
        heroi.nivel++;
        heroi.xp = 0;
        heroi.hpMax += 10;
        heroi.hp = heroi.hpMax;
        heroi.forca += 2;
        heroi.defesa += 1;
        heroi.agilidade += 1;
        heroi.xpProx = heroi.nivel * 100;
        
        // Limpar status negativos no level up
        heroi.status.veneno = 0;
        heroi.status.paralisia = 0;
        
        setTimeout(mostrarLevelUp, 1500);
    } else {
        setTimeout(fimBatalha, 2000);
    }
}

function derrota(){
    document.getElementById("battleLog").innerHTML += `<br><span style="color: #f44336;">Voc√™ foi derrotado pelo ${inimigo.nome}!</span>`;
    heroi.derrotas++;
    setTimeout(mostrarGameOver, 1500);
}

function fimBatalha(){
    // Limpar status negativos ao voltar para cidade
    heroi.status.veneno = 0;
    heroi.status.paralisia = 0;
    
    atualizarCidade();
    document.getElementById("batalha").style.display = "none";
    document.getElementById("cidade").style.display = "block";
}

function mostrarLevelUp(){
    document.getElementById("novoNivel").innerText = heroi.nivel;
    document.getElementById("telaLevelUp").style.display = "block";
}

function fecharLevelUp(){
    document.getElementById("telaLevelUp").style.display = "none";
    fimBatalha();
}

function mostrarGameOver(){
    document.getElementById("estatNivel").innerText = heroi.nivel;
    document.getElementById("estatXpTotal").innerText = heroi.xpTotal;
    document.getElementById("estatOuroFinal").innerText = heroi.ouro;
    document.getElementById("estatVitorias").innerText = heroi.vitorias;
    document.getElementById("estatDerrotas").innerText = heroi.derrotas;
    document.getElementById("telaGameOver").style.display = "block";
}

function reiniciarJogo(){
    heroi = {
        nome: "Her√≥i",
        nivel: 1,
        hpMax: 50,
        hp: 50,
        xp: 0,
        xpProx: 100,
        ouro: 100,
        forca: 10,
        defesa: 5,
        agilidade: 5,
        dano: 15,
        vitorias: 0,
        derrotas: 0,
        xpTotal: 0,
        status: {
            veneno: 0,
            paralisia: 0,
            forcaBuff: 0,
            defesaBuff: 0
        },
        inventario: {
            pocao: 2,
            antidoto: 1,
            pocaoForca: 0,
            pocaoDefesa: 0
        }
    };
    
    document.getElementById("telaGameOver").style.display = "none";
    document.getElementById("batalha").style.display = "none";
    document.getElementById("cidade").style.display = "block";
    atualizarCidade();
}

atualizarCidade();
</script>

</body>
</html>
