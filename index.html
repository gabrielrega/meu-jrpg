<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RPG Batalha por Turnos</title>
<style>
    body { background: #1a1a1a; color: #fff; font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    button { background: #444; color: #fff; border: none; padding: 10px 20px; margin: 5px; font-size: 1.2em; cursor: pointer; border-radius: 5px; }
    button:hover { background: #666; }
    #battleLog { width: 90%; height: 200px; background: #000; color: lime; overflow-y: auto; margin: 10px auto; padding: 10px; text-align: left; border: 1px solid #555; border-radius: 5px; }
    .bar-container { width: 80%; background: #333; margin: 5px auto; height: 20px; border-radius: 5px; overflow: hidden; }
    .hp-bar { height: 100%; background: #4caf50; width: 100%; transition: width 0.3s; }
    .xp-bar { height: 100%; background: #2196f3; width: 0%; transition: width 0.3s; }
    .ficha-personagem { background: #2a2a2a; border-radius: 10px; padding: 15px; margin: 20px auto; max-width: 400px; border: 2px solid #444; }
    .ficha-linha { display: flex; justify-content: space-between; margin: 8px 0; padding: 5px; background: #333; border-radius: 5px; }
    .ficha-label { font-weight: bold; color: #ffd700; }
    .combatentes { display: flex; justify-content: space-around; margin: 20px 0; }
    .combatente { background: #2a2a2a; border-radius: 10px; padding: 15px; margin: 10px; border: 2px solid #444; flex: 1; max-width: 300px; }
    .combatente h3 { color: #ffd700; margin-bottom: 10px; }
    #telaLevelUp { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); color: white; z-index: 9999; text-align: center; padding-top: 30%; }
    #telaLevelUp button { background: #ff9800; font-size: 1.2em; }
    @media (max-width: 600px) { .combatentes { flex-direction: column; } }
</style>
</head>
<body>

<div id="cidade">
    <h1>üè∞ Cidade</h1>
    <div class="ficha-personagem">
        <h2>‚öîÔ∏è Ficha do Personagem</h2>
        <div class="ficha-linha"><span class="ficha-label">Nome:</span><span id="nomeHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">N√≠vel:</span><span id="nivelHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">HP:</span><span><span id="hpHeroi"></span>/<span id="hpMaxHeroi"></span></span></div>
        <div class="bar-container"><div id="hpBar" class="hp-bar"></div></div>
        <div class="ficha-linha"><span class="ficha-label">XP:</span><span><span id="xpHeroi"></span>/<span id="xpProxNivel"></span></span></div>
        <div class="bar-container"><div id="xpBar" class="xp-bar"></div></div>
        <div class="ficha-linha"><span class="ficha-label">For√ßa:</span><span id="forcaHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Defesa:</span><span id="defesaHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Agilidade:</span><span id="agiHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Vit√≥rias:</span><span id="vitoriasHeroi"></span></div>
        <div class="ficha-linha"><span class="ficha-label">Derrotas:</span><span id="derrotasHeroi"></span></div>
    </div>
    <button onclick="recuperar()">üíö Recuperar</button>
    <button onclick="iniciarBatalha()">‚öîÔ∏è Lutar</button>
</div>

<div id="batalha" style="display:none;">
    <h1>‚öîÔ∏è Batalha</h1>
    <div class="combatentes">
        <div class="combatente">
            <h3>üë§ <span id="nomeHeroiBatalha"></span></h3>
            <p>N√≠vel: <span id="nivelHeroiBatalha"></span></p>
            <p>HP: <span id="hpHeroiBatalha"></span>/<span id="hpMaxHeroiBatalha"></span></p>
            <div class="bar-container"><div id="hpBarHeroiBatalha" class="hp-bar"></div></div>
            <p>Agi: <span id="agiHeroiBatalha"></span></p>
        </div>
        <div class="combatente">
            <h3>üëπ <span id="nomeInimigo"></span></h3>
            <p>HP: <span id="hpInimigo"></span>/<span id="hpMaxInimigo"></span></p>
            <div class="bar-container"><div id="hpBarInimigo" class="hp-bar" style="background:#f44336;"></div></div>
            <p>Agi: <span id="agiInimigo"></span></p>
        </div>
    </div>
    <div id="battleLog"></div>
    <button onclick="atacar()">‚öîÔ∏è Atacar</button>
    <button onclick="fugir()">üèÉ Fugir</button>
</div>

<div id="telaLevelUp">
    <h2>üéâ Voc√™ subiu para o n√≠vel <span id="novoNivel"></span>!</h2>
    <p>Seus atributos melhoraram!</p>
    <button onclick="fecharLevelUp()">OK</button>
</div>

<script>
let heroi = {
    nome: "Her√≥i",
    nivel: 1,
    hpMax: 50,
    hp: 50,
    xp: 0,
    xpProx: 100,
    forca: 10,
    defesa: 5,
    agilidade: 5,
    dano: 15, // fixo
    vitorias: 0,
    derrotas: 0
};

// Lista de monstros: nome, hp, forca, defesa, agilidade, peso
const listaMonstros = [
    {nome: "Slime", hpMax: 20, forca: 5, defesa: 2, agilidade: 3, peso: 40},
    {nome: "Lobo", hpMax: 30, forca: 8, defesa: 4, agilidade: 6, peso: 25},
    {nome: "Orc", hpMax: 45, forca: 12, defesa: 6, agilidade: 4, peso: 20},
    {nome: "Cavaleiro Negro", hpMax: 60, forca: 15, defesa: 10, agilidade: 7, peso: 10},
    {nome: "Drag√£o Jovem", hpMax: 80, forca: 20, defesa: 12, agilidade: 8, peso: 5}
];

let inimigo = {};

function atualizarCidade(){
    document.getElementById("nomeHeroi").innerText = heroi.nome;
    document.getElementById("nivelHeroi").innerText = heroi.nivel;
    document.getElementById("hpHeroi").innerText = heroi.hp;
    document.getElementById("hpMaxHeroi").innerText = heroi.hpMax;
    document.getElementById("hpBar").style.width = (heroi.hp/heroi.hpMax)*100 + "%";
    document.getElementById("xpHeroi").innerText = heroi.xp;
    document.getElementById("xpProxNivel").innerText = heroi.xpProx;
    document.getElementById("xpBar").style.width = (heroi.xp/heroi.xpProx)*100 + "%";
    document.getElementById("forcaHeroi").innerText = heroi.forca;
    document.getElementById("defesaHeroi").innerText = heroi.defesa;
    document.getElementById("agiHeroi").innerText = heroi.agilidade;
    document.getElementById("vitoriasHeroi").innerText = heroi.vitorias;
    document.getElementById("derrotasHeroi").innerText = heroi.derrotas;
}

function atualizarBatalha(){
    document.getElementById("nomeHeroiBatalha").innerText = heroi.nome;
    document.getElementById("nivelHeroiBatalha").innerText = heroi.nivel;
    document.getElementById("hpHeroiBatalha").innerText = heroi.hp;
    document.getElementById("hpMaxHeroiBatalha").innerText = heroi.hpMax;
    document.getElementById("hpBarHeroiBatalha").style.width = (heroi.hp/heroi.hpMax)*100 + "%";
    document.getElementById("agiHeroiBatalha").innerText = heroi.agilidade;
    document.getElementById("nomeInimigo").innerText = inimigo.nome;
    document.getElementById("hpInimigo").innerText = inimigo.hp;
    document.getElementById("hpMaxInimigo").innerText = inimigo.hpMax;
    document.getElementById("hpBarInimigo").style.width = (inimigo.hp/inimigo.hpMax)*100 + "%";
    document.getElementById("agiInimigo").innerText = inimigo.agilidade;
}

function selecionarInimigo(){
    let totalPeso = listaMonstros.reduce((sum, m) => sum + m.peso, 0);
    let r = Math.random() * totalPeso;
    for (let m of listaMonstros){
        if (r < m.peso) return JSON.parse(JSON.stringify(m));
        r -= m.peso;
    }
}

function recuperar(){
    heroi.hp = heroi.hpMax;
    atualizarCidade();
    alert("HP recuperado!");
}

function iniciarBatalha(){
    inimigo = selecionarInimigo();
    inimigo.hp = inimigo.hpMax;
    document.getElementById("battleLog").innerHTML = `Um ${inimigo.nome} apareceu!`;
    document.getElementById("cidade").style.display = "none";
    document.getElementById("batalha").style.display = "block";
    atualizarBatalha();
}

function chanceAcerto(agilAtacante, agilDefensor){
    let chance = 75 + (agilAtacante - agilDefensor) * 3;
    if(chance > 95) chance = 95;
    if(chance < 20) chance = 20;
    return chance;
}

function atacar(){
    if(Math.random() * 100 < chanceAcerto(heroi.agilidade, inimigo.agilidade)){
        inimigo.hp -= heroi.dano - Math.floor(inimigo.defesa/2);
        if(inimigo.hp < 0) inimigo.hp = 0;
        document.getElementById("battleLog").innerHTML += `<br>Voc√™ acertou e causou dano!`;
    } else {
        document.getElementById("battleLog").innerHTML += `<br>Voc√™ errou o ataque!`;
    }
    atualizarBatalha();
    if(inimigo.hp <= 0){ vitoria(); return; }
    setTimeout(turnoInimigo, 800);
}

function turnoInimigo(){
    if(Math.random() * 100 < chanceAcerto(inimigo.agilidade, heroi.agilidade)){
        let dano = inimigo.forca - Math.floor(heroi.defesa/2);
        if(dano < 1) dano = 1;
        heroi.hp -= dano;
        if(heroi.hp < 0) heroi.hp = 0;
        document.getElementById("battleLog").innerHTML += `<br>${inimigo.nome} acertou e causou ${dano} de dano!`;
    } else {
        document.getElementById("battleLog").innerHTML += `<br>${inimigo.nome} errou o ataque!`;
    }
    atualizarBatalha();
    if(heroi.hp <= 0){ derrota(); }
}

function fugir(){
    document.getElementById("battleLog").innerHTML += "<br>Voc√™ fugiu!";
    setTimeout(fimBatalha, 800);
}

function vitoria(){
    document.getElementById("battleLog").innerHTML += "<br>Voc√™ venceu!";
    heroi.vitorias++;
    heroi.xp += 50;
    if(heroi.xp >= heroi.xpProx){
        heroi.nivel++;
        heroi.xp = 0;
        heroi.hpMax += 10;
        heroi.hp = heroi.hpMax;
        heroi.forca += 2;
        heroi.defesa += 1;
        heroi.agilidade += 1;
        heroi.xpProx = heroi.nivel * 100;
        mostrarLevelUp();
    } else {
        fimBatalha();
    }
}

function derrota(){
    document.getElementById("battleLog").innerHTML += "<br>Voc√™ foi derrotado...";
    heroi.hp = 1;
    heroi.derrotas++;
    fimBatalha();
}

function fimBatalha(){
    atualizarCidade();
    document.getElementById("batalha").style.display = "none";
    document.getElementById("cidade").style.display = "block";
}

function mostrarLevelUp(){
    document.getElementById("novoNivel").innerText = heroi.nivel;
    document.getElementById("telaLevelUp").style.display = "block";
}

function fecharLevelUp(){
    document.getElementById("telaLevelUp").style.display = "none";
    fimBatalha();
}

atualizarCidade();
</script>

</body>
</html>
